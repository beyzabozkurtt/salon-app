<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Hizmetler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    .color-circle {
      width: 32px;
      height: 32px;
      border: 2px solid #ccc;
      border-radius: 50%;
      outline: none;
    }
    .color-circle:hover {
      cursor: pointer;
      opacity: 0.8;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-5">
   
    <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#createModal">+ Hizmet Oluştur</button>
    <ul id="serviceList" class="list-group"></ul>
  </div>

  <!-- Hizmet Ekle Modal -->
  <div class="modal fade" id="createModal" tabindex="-1">
    <div class="modal-dialog">
      <form id="createForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Yeni Hizmet</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <label class="form-label">Hizmet Adı</label>
          <input type="text" name="name" class="form-control mb-2" required />

          <label class="form-label">Renk Seç</label>
          <div id="colorOptions" class="d-flex gap-2 flex-wrap mb-2"></div>
          <input type="hidden" name="color" id="selectedColor" required />
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Kaydet</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Hizmet Güncelle Modal -->
  <div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog">
      <form id="editForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Hizmeti Güncelle</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="id" />
          <label class="form-label">Hizmet Adı</label>
          <input type="text" name="name" class="form-control mb-2" required />

          <label class="form-label">Renk Seç</label>
          <div id="editColorOptions" class="d-flex gap-2 flex-wrap mb-2"></div>
          <input type="hidden" name="color" id="editSelectedColor" required />
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Güncelle</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
        </div>
      </form>
    </div>
  </div>

 <script>
  const list = document.getElementById("serviceList");
  const createForm = document.getElementById("createForm");
  const editForm = document.getElementById("editForm");

  const token = localStorage.getItem("companyToken");
  const axiosConfig = {
    headers: { Authorization: "Bearer " + token }
  };

  const colorList = [
    "#33FF57", "#3357FF", "#FF33D4", "#FF8C00", "#800080",
    "#00CED1", "#FFD700", "#A52A2A", "#708090", "#8B4513"
  ];

  function setupEditColorSelector(selected = "") {
    const container = document.getElementById("editColorOptions");
    const input = document.getElementById("editSelectedColor");
    container.innerHTML = "";

    colorList.forEach(color => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "color-circle";
      btn.style.backgroundColor = color;

      if (color === selected) {
        btn.style.border = "3px solid black";
        input.value = color;
      }

      btn.addEventListener("click", () => {
        document.querySelectorAll("#editColorOptions .color-circle").forEach(b => b.style.border = "2px solid #ccc");
        btn.style.border = "3px solid black";
        input.value = color;
      });

      container.appendChild(btn);
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    const colorOptions = document.getElementById("colorOptions");
    const selectedColor = document.getElementById("selectedColor");

    colorList.forEach(color => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "color-circle";
      btn.style.backgroundColor = color;

      btn.addEventListener("click", () => {
        document.querySelectorAll(".color-circle").forEach(b => b.style.border = "2px solid #ccc");
        btn.style.border = "3px solid black";
        selectedColor.value = color;
      });

      colorOptions.appendChild(btn);
    });
  });

  async function loadServices() {
    const res = await axios.get("http://localhost:5001/api/services", axiosConfig);
    list.innerHTML = "";
    res.data.forEach(s => {
      const item = document.createElement("li");
      item.className = "list-group-item d-flex justify-content-between align-items-center";
      item.innerHTML = `
        <span>${s.name}</span>
        <div>
          <button class="btn btn-sm btn-primary me-2" onclick='editService(${JSON.stringify(s)})'>Düzenle</button>
          <button class="btn btn-sm btn-danger" onclick='deleteService(${s.id})'>Sil</button>
        </div>
      `;
      list.appendChild(item);
    });
  }

  createForm.addEventListener("submit", async e => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(createForm));
    await axios.post("http://localhost:5001/api/services", data, axiosConfig);
    createForm.reset();
    bootstrap.Modal.getInstance(document.getElementById("createModal")).hide();
    loadServices();
  });

  function editService(service) {
    editForm.id.value = service.id;
    editForm.name.value = service.name;
    setupEditColorSelector(service.color || "#33FF57");
    bootstrap.Modal.getOrCreateInstance(document.getElementById("editModal")).show();
  }

  editForm.addEventListener("submit", async e => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(editForm));
    await axios.put(`http://localhost:5001/api/services/${data.id}`, data, axiosConfig);
    bootstrap.Modal.getInstance(document.getElementById("editModal")).hide();
    loadServices();
  });

  async function deleteService(id) {
    if (confirm("Bu hizmet silinsin mi?")) {
      await axios.delete(`http://localhost:5001/api/services/${id}`, axiosConfig);
      loadServices();
    }
  }

  loadServices();
</script>

</body>
</html>
